/* Snipper is a small javascript to add the html5 details/summary functionality to alld browsers :: MIT+BSD license :: http://mudasobwa.github.com *//** 
* Draws a rounded rectangle using the current state of the canvas.  
* If you omit the last three params, it will draw a rectangle  
* outline with a 5 pixel border radius  
*
* author: http://stackoverflow.com/a/7592676
*
* @param {Number} x The top left x coordinate 
* @param {Number} y The top left y coordinate  
* @param {Number} width The width of the rectangle  
* @param {Number} height The height of the rectangle 
* @param {Object} radius All corner radii. Defaults to 0,0,0,0; 
* @param {Boolean} fill Whether to fill the rectangle. Defaults to false. 
* @param {Boolean} stroke Whether to stroke the rectangle. Defaults to true. 
*/CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e,f,g){var h={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};typeof g=="undefined"&&(g=!0);if(typeof e=="object")for(var i in e)h[i]=e[i];this.beginPath(),this.moveTo(a+h.upperLeft,b),this.lineTo(a+c-h.upperRight,b),this.quadraticCurveTo(a+c,b,a+c,b+h.upperRight),this.lineTo(a+c,b+d-h.lowerRight),this.quadraticCurveTo(a+c,b+d,a+c-h.lowerRight,b+d),this.lineTo(a+h.lowerLeft,b+d),this.quadraticCurveTo(a,b+d,a,b+d-h.lowerLeft),this.lineTo(a,b+h.upperLeft),this.quadraticCurveTo(a,b,a+h.upperLeft,b),this.closePath(),g&&this.stroke(),f&&this.fill()};var snipper={magicHeight:22,magicSubHeight:50,snipperTitle:"Code listing #",snipperId:0,isNativelySupported:function(){var a=function(a){var b=a.createElement("details"),c,d,e;return"open"in b?(d=a.body||function(){var b=a.documentElement;return c=!0,b.insertBefore(a.createElement("body"),b.firstElementChild||b.firstChild)}(),b.innerHTML="<summary>a</summary>b",b.style.display="block",d.appendChild(b),e=b.offsetHeight,b.open=!0,e=e!=b.offsetHeight,d.removeChild(b),c&&d.parentNode.removeChild(d),e):!1}(document);return a}(),init:function(a,b,c){if(this.isNativelySupported)return;a&&(this.snipperTitle=a),this.initDefaultCss(b);var d=document.getElementsByTagName("details");for(var e=0;e<d.length;e++)(!b||(new RegExp(b,"i")).test(d[e].className))&&this.initDetail(d[e],c);this.initPres()},initDefaultCss:function(a){if(this.isNativelySupported)return;var b=document.createElement("style");b.type="text/css";var c="details"+(a?"."+a:"");b.innerHTML=c+", "+c+" summary { display: block; } "+c+" summary { cursor: pointer; } "+c+" summary.opened:before  { content: '▾ '; } "+c+" summary.closed:before  { content: '▸ '; } "+c+" summary.snipper:before { content: none; } ",document.getElementsByTagName("head")[0].appendChild(b)},initDetail:function(a,b){if(this.isNativelySupported)return;if(!a||!a.tagName||a.tagName.toLowerCase()!=="details")return;var c=a.firstChild;for(;c;c=c.nextSibling)if(c.nodeType==1&&c.tagName&&c.tagName.toLowerCase()==="summary"){var d=this;c.onclick=function(a){d.toggleDetail(a)},this.setOpenClose(c,b);break}},setOpenClose:function(a,b){if(this.isNativelySupported)return;var c=a.parentNode.firstChild;for(;c;c=c.nextSibling)c.nodeType==1&&c!=a&&(c.tagName.toLowerCase()==="pre"?c.style.height=b||this.magicSubHeight>=c.parentNode.offsetHeight-this.magicHeight?"auto":""+this.magicSubHeight+"px":c.className&&c.className.toLowerCase()!=="snipper-fader"?c.style.display=b?"block":"none":c.style.display=b?"none":"block",c.style.overflow="hidden");a.className=a.className.replace(/opened|closed/g,"")+(b?" opened":" closed")},toggleOpenClose:function(a){if(this.isNativelySupported)return;a&&a.tagName&&a.tagName.toLowerCase()==="summary"&&this.setOpenClose(a,!a.className||/closed/.test(a.className))},toggleDetail:function(a){if(this.isNativelySupported)return;var b;if(!a)var a=window.event;a.target?b=a.target:a.srcElement&&(b=a.srcElement),b.nodeType==3&&(b=b.parentNode),b.tagName.toLowerCase()==="canvas"&&(this.drawControlButton(b,b.getContext("2d"),/closed/.test(b.parentNode.className)),b=b.parentNode),this.toggleOpenClose(b)},prepareShadow:function(a,b,c,d,e){b|=0,c|=0,d|=0,a.shadowOffsetX=b,a.shadowOffsetY=c,a.shadowBlur=d,a.shadowColor=e?e:"#FFF"},drawCaptionBG:function(a,b,c,d){var e=a.height/2,f=c?c:"#666",g=d?d:"#CCC",h=b.createLinearGradient(0,0,0,a.height);h.addColorStop(0,f),h.addColorStop(1,g),b.fillStyle=h,b.strokeStyle=f,b.roundRect(0,0,a.width,a.height,{upperLeft:e,upperRight:e},!0,!0)},drawCaptionText:function(a,b,c,d,e){d|=a.height*.54,b.font="bold "+d+"px Ubuntu",b.fillStyle=e?e:"#FFF",b.fillText(c,a.height*2,a.height/2+d*.3)},drawControlButton:function(a,b,c,d,e){shadowSz=4,y=a.height*.5,r=a.height*.3,x=a.height*.75,_cl=d?d:"#999",b.beginPath(),b.arc(x,y,r,0,2*Math.PI,!1);var f=b.createRadialGradient(x-r/2,y-r/2,0,x,y,r);f.addColorStop(0,"#FFF"),f.addColorStop(1,_cl),b.fillStyle=f,this.prepareShadow(b,-1,-1,shadowSz,"#999"),b.fill(),b.strokeStyle=_cl,b.stroke(),b.font="normal "+(1+2*r)+"px Ubuntu",b.fillStyle=e?e:"#666",b.fillText(c?"▾":"▸",x-r/2+(c?0:1),y+r/2)},drawCaption:function(a,b,c){var d=a.getContext("2d");this.drawCaptionBG(a,d),this.drawCaptionText(a,d,b),this.drawControlButton(a,d,c)},findCode:function(a){for(var b=a.firstChild;b;b=b.nextSibling){if(b.nodeName=="CODE")return b;if(b.nodeType!=3||!b.nodeValue.match(/\s+/))break}},createFader:function(a){var b=document.createElement("div");return b.className="snipper-fader",b.style.width=""+a+"px",b.style.height=""+this.magicSubHeight+"px",b.style.position="absolute",b.style.margin.top="10%",b.style.background="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIwIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNmZmZmZmYiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+)",b},initPres:function(a,b){var c=document.getElementsByTagName("pre");for(var d=0;d<c.length;d++)(!a||(new RegExp(a,"i")).test(dets[d].className))&&this.findCode(c[d])&&this.initPre(c[d],b)},initPre:function(a,b){var c=document.createElement("details");c.style.minHeight=""+(this.magicHeight+this.magicSubHeight)+"px",a.parentNode.insertBefore(c,a);var d=document.createElement("summary");a.style.margin="0 0 1em 0",a.style.padding="0 1em",a.style.border="1px solid #ccc",d.style.height=""+this.magicHeight+"px",d.className="snipper";var e=document.createElement("canvas");e&&(e.height=this.magicHeight,e.width=a.offsetWidth,e.class="snipper",e.style.cursor="pointer",e.onclick=function(a){snipper.toggleDetail(a)},d.appendChild(e),snipper.drawCaption(e,this.snipperTitle+ ++this.snipperId)),c.appendChild(d),c.appendChild(a),c.insertBefore(snipper.createFader(a.offsetWidth),a),snipper.setOpenClose(d,!1)}};